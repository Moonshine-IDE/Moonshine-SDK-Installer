<project name="MoonshineBuildScriptLibrary" basedir="." default="checkOS" >
	<description>
		This is a library shared ANT tasks to be used for building ElCapitan Sandbox test project.
	</description>
 	
	<tstamp>
		<format property="timestamp" pattern="yyyy-MM-dd_HH-mm-ss" />
	</tstamp>
	
	<!--
	//==========================================================================
	//
	//  PROPERTIES
	//
	//==========================================================================
	-->
	
	<!-- Unchanging the following value will make script build 'locally'. 
		 Updating this by command-line injection will act script to build at Bamboo.
		 Expected value for command-line injection are 'true' or 'false' -->
	<property name="HELPER_IS_DESKTOP" value="HELPER_IS_DESKTOP"/>
	
	<!-- Compilers and Flex SDK configuration -->
	<xmlproperty file="ApplicationProperties.xml" keeproot="false" semanticattributes="true" prefix="APP_PROPERTIES"/>
	<taskdef resource="net/sf/antcontrib/antcontrib.properties" classpath="ant-contrib-0.6.jar"/>
	<property name="keepDebugFiles" value="${APP_PROPERTIES.keepDebugFiles}" />
	<property name="deploy_dir" value="DEPLOY"/>
	<property name="debug_dir" value="bin-debug"/>

	<if>
		<!-- This expected value means its not running on Bamboo -->
		<equals arg1="${HELPER_IS_DESKTOP}" arg2="HELPER_IS_DESKTOP"/>
		<then>
			<echo>Reading properties from local ApplicationProperties</echo>
			<property name="IsDesktopBuild" value="${APP_PROPERTIES.isDesktop}"/>
			<property name="IsDevelopmentBuild" value="${APP_PROPERTIES.isDevelopmentVersion}"/>
			<property name="BuildVersion" value="${APP_PROPERTIES.buildVersion}"/>
			<property name="Is.Signed.Build" value="${APP_PROPERTIES.isSignedBuild}"/>
			<property name="certSignedAIR" value="${APP_PROPERTIES.certSignedAIR}" />
			<property name="certSignedAIRPassword" value="${APP_PROPERTIES.certSignedAIRPass}" />
			<property name="certSignedWindowsBinary" value="${APP_PROPERTIES.certSignedWindowsBinary}" />
			<property name="certSignedWindowsBinaryPassword" value="${APP_PROPERTIES.certSignedWindowsBinaryPass}" />
			<property name="certSignedDevIDKeychainName" value="${APP_PROPERTIES.certSignedDevIDKeychainName}" />
			<property name="certSignedMacOSKeychainName" value="${APP_PROPERTIES.certSignedMacOSKeychainName}" />
			<property name="certSignedMacOSKeychainInstallerName" value="${APP_PROPERTIES.certSignedMacOSKeychainInstallerName}" />
			<property name="certSignedMacOSKeychainPass" value="${APP_PROPERTIES.certSignedMacOSKeychainPass}" />
			<property name="svn.revision" value="3913"/>
		</then>
		<else>
			<echo>Reading properties from Bamboo Variables</echo>
			<property name="IsDesktopBuild" value="${HELPER_IS_DESKTOP}"/>
			<property name="IsDevelopmentBuild" value="${HELPER_IS_DEVELOPMENT_VERSION}"/>
			<property name="BuildVersion" value="${HELPER_VERSION}"/>
			<property name="Is.Signed.Build" value="${IS_SIGNED_BUILD}"/>
			<property name="certSignedAIR" value="${CERT_WIN_AIR}" />
			<property name="certSignedAIRPassword" value="${CERT_WIN_AIR_PASS}" />
			<property name="certSignedWindowsBinary" value="${CERT_WIN_INSTALLER}" />
			<property name="certSignedWindowsBinaryPassword" value="${CERT_WIN_INSTALLER_PASS}" />
			<property name="certSignedDevIDKeychainName" value="${CERT_DEV_ID_KEYCHAIN}" />
			<property name="certSignedMacOSKeychainName" value="${CERT_OSX_KEYCHAIN}" />
			<property name="certSignedMacOSKeychainInstallerName" value="${CERT_OSX_KEYCHAIN_INSTALLER}" />
			<property name="certSignedMacOSKeychainPass" value="${CERT_OSX_KEYCHAIN_PASS}" />
			<property name="svn.revision" value="${svn.revision}" />
		</else>
	</if>
	
	<echo>OS BIT : ${os.arch}</echo>
	<if>
		<os family="windows"/>
		<then>
			<if>
				<os arch="x86"/>
				<then>
					<propertycopy property="FLEX_HOME" from="APP_PROPERTIES.winSDKPath" silent="true" />
				</then>
				<else>
					<propertycopy property="FLEX_HOME" from="APP_PROPERTIES.winSDKPath64" silent="true" />
				</else>
			</if>
		</then>
		<else>
			<propertycopy property="FLEX_HOME" from="APP_PROPERTIES.unixSDKPath" silent="true" />
		</else>
	</if>
	
	<condition property="Is.FLEX_HOME.Not.Exists" else="false">
		<or>
			<and>
				<equals arg1="${FLEX_HOME}" arg2=""/>
			</and>
			<not>
				<available file="${FLEX_HOME}"/>
			</not>
		</or>
	</condition>
	
	<!-- Read all environment properties -->
	<property environment="env"/>
	<!-- Check and set if Flex SDK already setup as environment variable -->
	<propertycopy property="FLEX_HOME" from="env.FLEX_HOME" silent="true" override="${Is.FLEX_HOME.Not.Exists}"/>
	<echo>SDK : ${FLEX_HOME}</echo>
	
    <!-- Path to your Flex SDK with AIR 3.1 overlaid -->
	<taskdef resource="flexTasks.tasks" classpath="${FLEX_HOME}/ant/lib/flexTasks.jar"/>
    <property name="mxmlc_path" value="${FLEX_HOME}/lib/mxmlc.jar" />
    <property name="adt_path" value="${FLEX_HOME}/lib/adt.jar" />
 
    <!-- Application configuration -->
    <property name="swfFilename" value="${debug_dir}/MoonshineSDKInstaller.swf" />
	<property name="applicationSourceDirectory" value="../src"/>
	<property name="LibraryHelperSharedCore" value="../../InstallerSharedCore"/>
	<property name="desktopMainSource" value="${applicationSourceDirectory}/MoonshineSDKInstaller.mxml" />
	<property name="desktopApplicationDescriptor" value="${debug_dir}/MoonshineSDKInstaller-app.xml" />
	<property name="desktopApplicationDescriptorOriginal" value="${applicationSourceDirectory}/MoonshineSDKInstaller-app.xml" />
	<property name="apacheInstallerSourceDirectory" value="../../flex-utilities/flex-installer"/>
	<property name="mashLibrarySourceDirectory" value="../../ApacheFlexSDKInstallerLib"/>
	
	<!-- Desktop configuration -->
	<property name="certSelfSignedNameOnly" value="MoonshineSelfSignedCertificate" />
	<property name="certSelfSigned" value="MoonshineSelfSignedCertificate.p12" />
	<property name="certSelfSignedPassword" value="moonshine" />
	
	<condition property="Is.Keychain.Certificate.Defined">
		<and>
			<not>
				<equals arg1="${certSignedMacOSKeychainInstallerName}" arg2=""/>
			</not>
			<not>
				<equals arg1="${certSignedMacOSKeychainInstallerName}" arg2="CERT_OSX_KEYCHAIN_INSTALLER"/>
			</not>
			<not>
				<equals arg1="${certSignedMacOSKeychainPass}" arg2=""/>
			</not>
			<not>
				<equals arg1="${certSignedMacOSKeychainPass}" arg2="CERT_OSX_KEYCHAIN_PASS"/>
			</not>
		</and>
	</condition>
	<echo>Is.Keychain.Certificate.Defined: ${Is.Keychain.Certificate.Defined}</echo>
	
	
	<!--
	//==========================================================================
	//
	//  TASKS
	//
	//==========================================================================
	-->
	
	<!-- OS Check and decision on opening Task -->
	<target name="checkOS">
		<if>
			<os family="windows"/>
			<then>
				<antcall target="disposeTempWindows"></antcall>
			</then>
		<elseif>
			<os family="unix"/>
			<then>
				<antcall target="disposeTempUNIX"></antcall>
			</then>
		</elseif>
		</if>
	</target>

	<!-- Create a certificate if it doesn't exist already -->
	<target name="createCertificate" unless="certSelfSigned.exists">
		<echo>Self-signed .p12 certificate generation</echo>
		<java jar="${adt_path}" fork="true" failonerror="true">
			<arg line="-certificate" />
			<arg line="-cn '${certSelfSignedNameOnly}'" />
			<arg line="2048-RSA" />
	   		<arg line="${certSelfSigned}" />
	   		<arg line="${certSelfSignedPassword}"/>
		</java>
		<copy file="${certSelfSigned}" todir="${debug_dir}" overwrite="true"/>
	 </target>
	
	<!--
	//==========================================================================
	//
	//  WINDOWS
	//
	//==========================================================================
	-->
	
	<!-- Windows signed packaging initiator -->
	<target name="signedSigningBuild" if="${Is.Signed.Build}">
		<antcall target="CompileSWFWindowsSignedPackage"></antcall>
	</target>

	<!-- Windows packaging/signing Task -->
	<target name="CompileSWFWindowsSignedPackage" depends="CompileSWF">
		<echo>Signed Process Running</echo>
		<java jar="${adt_path}" fork="true" failonerror="true">
			<arg line="-package" />
			<arg line="-storetype pkcs12" />
			<arg line="-keystore '${debug_dir}/${certSelfSigned}'" />
	   		<arg line="-storepass '${certSelfSignedPassword}'" />
			<arg line="-tsa 'http://timestamp.comodoca.com/rfc3161'" />
	   		<arg line="-target bundle"/>
	   		<arg line="-storetype pkcs12" />
	   		<arg line="-keystore '${certSignedWindowsBinary}'" />
	   		<arg line="-storepass '${certSignedWindowsBinaryPassword}'" />
	   		<arg line="${desktopBinaryFilename}" />
	   		<arg line="'${desktopApplicationDescriptor}'" />
	   		<arg line="'${swfFilename}'" />
			<arg line="installer"/>
			<arg line="images"/>
			<arg line="helperResources"/>
			<arg line="shellScripts"/>
	   		<!-- Add folders to be bundled in the AIR file here -->
		</java>
		<antcall target="zipCaptiveBundle"></antcall>
	 </target>
	
	<!-- Windows self-signed packaging initiator -->
	<target name="normalSigningBuild" unless="${Is.Signed.Build}">
		<antcall target="CompileSWFWindowsSelfSignedPackage"></antcall>
	</target>

	 <!-- Windows packaging/signing Task -->
	<target name="CompileSWFWindowsSelfSignedPackage" depends="CompileSWF">
		<echo>Self-signed Process Running</echo>
		<java jar="${adt_path}" fork="true" failonerror="true">
			<arg line="-package" />
			<arg line="-storetype pkcs12" />
			<arg line="-keystore '${debug_dir}/${certSelfSigned}'" />
	   		<arg line="-storepass '${certSelfSignedPassword}'" />
			<arg line="-tsa 'http://timestamp.comodoca.com/rfc3161'" />
	   		<arg line="-target bundle"/>
	   		<arg line="${desktopBinaryFilename}" />
	   		<arg line="'${desktopApplicationDescriptor}'" />
	   		<arg line="'${swfFilename}'" />
			<arg line="installer"/>
			<arg line="images"/>
			<arg line="helperResources"/>
			<arg line="shellScripts"/>
	   		<!-- Add folders to be bundled in the AIR file here -->
		</java>
		<antcall target="zipCaptiveBundle"></antcall>
	 </target>
	
	<target name="zipCaptiveBundle">
		<zip destfile="${desktopBinaryFilename}.zip" basedir="${desktopBinaryFilename}"/>
	</target>
	
	<!--
	//==========================================================================
	//
	//  MACOS
	//
	//==========================================================================
	-->
	
	<!-- Compile .app to next use in .pkg building -->
	<!--target name="compile app project" depends="compile dmg project"-->
	<target name="compile app project" depends="CompileSWF">
		<java jar="${adt_path}" fork="true" failonerror="true">
			<arg line="-package" />
			<arg line="-storetype pkcs12" />
			<arg line="-keystore '${certSelfSigned}'" />
			<arg line="-storepass '${certSelfSignedPassword}'" />
			<arg line=" -tsa 'http://timestamp.comodoca.com/rfc3161'" />
			<arg line="-target bundle"/>
			<arg line="'${desktopBinaryFilename}'" />
			<arg line="'${desktopApplicationDescriptor}'" />
			<arg line="'${swfFilename}'" />
			<arg line="installer"/>
			<arg line="images"/>
			<arg line="helperResources"/>
			<arg line="shellScripts"/>
			<!-- Add folders to be bundled in the AIR file here -->
		</java>
	</target>
	
	<!-- Compile .pkg to distribute through app store -->
	<target name="buildAppStorePKG" depends="compile app project" if="${Is.Keychain.Certificate.Defined}">
		<copy tofile="${desktopBinaryFilename}/Contents/Resources/Icon.icns" file="${basedir}/moonshineASHIcons.icns" overwrite="true"/>
		<replace file="${desktopBinaryFilename}/Contents/Info.plist">
				<replacetoken><![CDATA[<string>Icon.icns</string>]]></replacetoken>
				<replacevalue><![CDATA[<string>Icon.icns</string>
		<key>CFBundleName</key>
		<string>Moonshine SDK Installer</string>
		<key>LSApplicationCategoryType</key>
		<string>public.app-category.developer-tools</string>
		<key>CFBundleVersion</key>
		<string>1.0</string>
		<key>postinstall_script</key>
		<string>#!/bin/sh
			open -a /Applications/Moonshine\ SDK\ Installer.app/
			exit 0</string>]]></replacevalue>
		</replace>
		<exec executable="bash">
			<arg value="-c"/>
			<arg value='security unlock-keychain -p "${certSignedMacOSKeychainPass}"'/>
		</exec>
		<exec executable="bash">
			<arg value="-c"/>
			<arg value="rm '${desktopBinaryFilename}'/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0/Resources/WebKit.dylib"/>
		</exec>
		<exec executable="bash">
			<arg value="-c"/>
			<arg value="chmod -R 777 '${desktopBinaryFilename}'"/>
		</exec>
		<!--exec executable="bash">
			<arg value="-c"/>
			<arg value="rm ${desktopBinaryFilename}/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0/Resources/AdobeCP15.plugin/Contents/Info.plist"/>
		</exec-->
		<exec executable="bash">
			<arg value="-c"/>
			<arg value="rm '${desktopBinaryFilename}'/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0/Resources/Flash\ Player.plugin/Contents/Info.plist"/>
		</exec>
		<exec executable="bash">
			<arg value="-c"/>
			<arg value="rm '${desktopBinaryFilename}'/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0/Adobe\ AIR_64\ Helper"/>
		</exec>
		<exec executable="bash">
			<arg value="-c"/>
			<arg value="rm '${desktopBinaryFilename}'/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0/Resources/ExtendedAppEntryTemplate64"/>
		</exec>
		<!--exec executable="bash">
			<arg value="-c"/>
			<arg value='codesign -f -v -s "${certSignedMacOSKeychainName}" ${desktopBinaryFilename}/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0/Resources/AdobeCP15.plugin/Contents/MacOS/AdobeCP'/>
		</exec-->
		<!--exec executable="bash">
			<arg value="-c"/>
			<arg value='codesign -f -v -s "${certSignedMacOSKeychainName}" ${desktopBinaryFilename}/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0/Resources/AdobeCP15.plugin'/>
		</exec-->
		<!--exec executable="bash">
			<arg value="-c"/>
			<arg value='codesign -f -v -s "${certSignedMacOSKeychainName}" ${desktopBinaryFilename}/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0/Resources/Flash\ Player.plugin'/>
		</exec-->
		<!--exec executable="bash">
			<arg value="-c"/>
			<arg value='codesign -f -v -s "${certSignedMacOSKeychainName}" ${desktopBinaryFilename}/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0/Resources/Flash\ Player.plugin/Contents/Resources/FlashPlayer-10.6.rsrc'/>
		</exec-->
		<exec executable="bash">
			<arg value="-c"/>
			<arg value='codesign -f -v -s "${certSignedMacOSKeychainName}" "${desktopBinaryFilename}"/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0/Resources/Flash\ Player.plugin/Contents/MacOS/FlashPlayer-10.6'/>
		</exec>
		<!--exec executable="bash">
			<arg value="-c"/>
			<arg value='codesign -f -v -s "${certSignedMacOSKeychainName}" ${desktopBinaryFilename}/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0/Adobe\ AIR_64\ Helper'/>
		</exec-->
		<exec executable="bash">
			<arg value="-c"/>
			<arg value='codesign -f -v -s "${certSignedMacOSKeychainName}" "${desktopBinaryFilename}"/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0/Adobe\ AIR_64'/>
		</exec>
		<exec executable="bash">
			<arg value="-c"/>
			<arg value='codesign -f -v -s "${certSignedMacOSKeychainName}" "${desktopBinaryFilename}"/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0/Adobe\ AIR'/>
		</exec>
		<exec executable="bash">
			<arg value="-c"/>
			<arg value='codesign -f -v -s "${certSignedMacOSKeychainName}" "${desktopBinaryFilename}"/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0/Resources/Adobe\ AIR.vch'/>
		</exec>
		<!--exec executable="bash">
			<arg value="-c"/>
			<arg value='codesign -f -v -s "${certSignedMacOSKeychainName}" ${desktopBinaryFilename}/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0/Resources/ExtendedAppEntryTemplate64'/>
		</exec-->
		<!--exec executable="bash">
			<arg value="-c"/>
			<arg value='codesign -f -v -s "${certSignedMacOSKeychainName}" ${desktopBinaryFilename}/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0/Resources/adobecp.plugin'/>
		</exec-->
		<exec executable="bash">
			<arg value="-c"/>
			<arg value='codesign -f -v -s "${certSignedMacOSKeychainName}" "${desktopBinaryFilename}"/Contents/Frameworks/Adobe\ AIR.framework/Versions/1.0'/>
		</exec>
		<exec executable="bash">
			<arg value="-c"/>
			<arg value='codesign -f -v -s "${certSignedMacOSKeychainName}" "${desktopBinaryFilename}"/Contents/Frameworks/Adobe\ AIR.framework'/>
		</exec>
		<exec executable="bash">
			<arg value="-c"/>
			<arg value='codesign -f -v -s "${certSignedMacOSKeychainName}" --entitlements ${debug_dir}/entitlement.plist "${desktopBinaryFilename}"'/>
		</exec>
		<exec executable="bash" failonerror="true">
			<arg value="-c"/>
			<arg value='productbuild --component "${desktopBinaryFilename}" /Applications ${deploy_dir}/"${installerName}".pkg --sign "${certSignedMacOSKeychainInstallerName}"'/>
		</exec>
		<!--exec executable="bash" failonerror="true">
			<arg value="-c"/>
			<arg value='pkgbuild -/-root "${desktopBinaryFilename}" -/-scripts Scripts -/-install-location /Applications/"${installerName}".app ${deploy_dir}/"${installerName}".pkg -/-sign "${certSignedMacOSKeychainInstallerName}"'/>
		</exec-->
		<exec executable="bash" failonerror="true">
			<arg value="-c"/>
			<arg value='productsign --sign "Developer ID Installer: Prominic.NET, Inc." ${deploy_dir}/"${installerName}".pkg ${deploy_dir}/"${installerName}"_Signed_OffAppStore_Distribution.pkg'/>
		</exec>
	</target>
	
	<!--
	//==========================================================================
	//
	//  GLOBAL
	//
	//==========================================================================
	-->
	
	<!-- delete and recreate the DEPLOY dir -->
	<target name="init">
		<delete dir="${deploy_dir}"/>
		<delete dir="${debug_dir}" />
		<mkdir dir="${deploy_dir}" />
		<mkdir dir="${debug_dir}" />
	</target>
	
	<!-- modify in the descriptor file -->
	<target name="modifyDescriptor" depends="init" if="${IsDesktopBuild}">
		<copy file="${desktopApplicationDescriptorOriginal}" todir="${debug_dir}" overwrite="true"/>
		<copy todir="${basedir}/installer" overwrite="true">
			<fileset dir="${applicationSourceDirectory}/installer"/>
		</copy>
		<copy todir="${basedir}/images" overwrite="true">
			<fileset dir="${applicationSourceDirectory}/assets/images"/>
		</copy>
		<copy todir="${basedir}/helperResources" overwrite="true">
			<fileset dir="${LibraryHelperSharedCore}/src/helperResources"/>
		</copy>
		<copy todir="${basedir}/shellScripts" overwrite="true">
			<fileset dir="${applicationSourceDirectory}/shellScripts"/>
		</copy>
		
		<!-- modify field values based upon isDevelopment tag -->
		<if>
			<equals arg1="${IsDevelopmentBuild}" arg2="true"/>
			<then>
				<property name="applicationID" value="net.prominic.MoonshineAppStoreHelper-dev"/>
				<property name="applicationName" value="Moonshine SDK Installer Development"/>
				<property name="executableName" value="Moonshine SDK Installer Development" />
				<property name="installerName" value="MoonshineSDKInstallerDevelopment" />
			</then>
			<else>
				<property name="applicationID" value="net.prominic.MoonshineAppStoreHelper"/>
				<property name="applicationName" value="Moonshine SDK Installer"/>
				<property name="executableName" value="Moonshine SDK Installer" />
				<property name="installerName" value="MoonshineSDKInstaller" />
			</else>			
		</if>
		
		<if>
			<os family="unix"/>
			<then>
				<property name="desktopBinaryFilename" value="${deploy_dir}/${installerName}.app"/>
				<copy file="entitlement.plist" todir="${debug_dir}" overwrite="true"/>
			</then>
			<else>
				<property name="desktopBinaryFilename" value="${deploy_dir}/${installerName}_64bit"/>
			</else>
		</if>

		<!-- Check if the self-signed certificate exists -->
		<copy file="${certSelfSigned}" todir="${debug_dir}" overwrite="true"/>
		
		<replaceregexp file="${desktopApplicationDescriptor}" match="filenameToBeReplacedByANT" replace="${executableName}" />
		<replaceregexp file="${desktopApplicationDescriptor}" match="nameToBeReplacedByANT" replace="${applicationName} ${BuildVersion}" encoding="utf-8" />
		<replaceregexp file="${desktopApplicationDescriptor}" match="idToBeReplacedByANT" replace="${applicationID}" />
		<replaceregexp file="${desktopApplicationDescriptor}" match="0.0.0" replace="${BuildVersion}" />
		<replace file="${desktopApplicationDescriptor}" token="[This value will be overwritten by Flash Builder in the output app.xml]" value="${swfFilename}" />
	</target>
	
	<target name="createBuildInfoFile" depends="modifyDescriptor">
		<echo file="${basedir}/images/appProperties.txt" append="false">${svn.revision}</echo>
	</target>
	
	<!-- Compile SWF to build directory for desktop packaging -->
	<target name="CompileSWF" depends="createBuildInfoFile">
		<mxmlc file="${desktopMainSource}" 
			   output="${swfFilename}" 
			   swf-version="41" 
			   configname="air" 
			   fork="true" 
			   optimize="true" 
			   debug="false" 
			   actionscript-file-encoding="UTF-8" 
			   incremental="false"
			   keep-generated-actionscript="false"
			   allow-source-path-overlap="true">
			<load-config filename="${FLEX_HOME}/frameworks/air-config.xml"/>
			<source-path path-element="${applicationSourceDirectory}"/>
			<source-path path-element="${apacheInstallerSourceDirectory}/common/src"/>
			<source-path path-element="${apacheInstallerSourceDirectory}/ant_on_air/external"/>
			<source-path path-element="${apacheInstallerSourceDirectory}/ant_on_air/src"/>
			<source-path path-element="${apacheInstallerSourceDirectory}/ant_on_air/locale/{locale}"/>
			<source-path path-element="${mashLibrarySourceDirectory}/src"/>
			<source-path path-element="${LibraryHelperSharedCore}/src"/>
			<compiler.library-path dir="${mashLibrarySourceDirectory}/libs" append="true">
				<include name="*.swc" />
			</compiler.library-path>
			<library-path dir="${debug_dir}" includes="*.swc" append="true" />
		</mxmlc>
	</target>
	
	<!-- Deletes temporary files for Windows -->
	<target name="disposeTempWindows" depends="normalSigningBuild,signedSigningBuild">
		<if>
			<equals arg1="${keepDebugFiles}" arg2="false"/>
			<then>
				<delete dir="${debug_dir}" />
				<delete dir="installer"/>
				<delete dir="images"/>
				<delete dir="helperResources"/>
				<delete dir="shellScripts"/>
			</then>
		</if>
	</target>
	
	<!-- Deletes temporary files for OSX -->
	<target name="disposeTempUNIX" depends="buildAppStorePKG">
		<if>
			<equals arg1="${keepDebugFiles}" arg2="false"/>
			<then>
				<delete dir="${debug_dir}" />
				<delete dir="installer"/>
				<delete dir="images"/>
				<delete dir="helperResources"/>
				<delete dir="shellScripts"/>
			</then>
		</if>
	</target>
</project>